<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced To-Do List</title>
    <style>
        /* Your CSS styles go here */
    </style>
</head>
<body>

<div class="container">
    <h1>To-Do List</h1>
    <input type="text" id="taskInput" placeholder="Add a new task">
    <button onclick="addTask()">Add Task</button>
    <button onclick="saveTasks()">Save Tasks</button>
    <label for="fileInput">Select File:</label>
    <input type="file" id="fileInput" accept=".json" onchange="loadTasks()">
    <button onclick="saveTaskToFile()">Save Task to File</button>
    <ul id="taskList"></ul>
</div>

<script>
    // Function to add a task to the list
    function addTask() {
        var taskInput = document.getElementById('taskInput');
        var taskList = document.getElementById('taskList');

        if (taskInput.value.trim() !== '') {
            var li = document.createElement('li');
            li.innerHTML = taskInput.value + '<span class="delete" onclick="removeTask(this)">Delete</span>';
            taskList.appendChild(li);
            taskInput.value = '';
        }
    }

    // Function to remove a task from the list
    function removeTask(spanElement) {
        var li = spanElement.parentElement;
        li.remove();
    }

    // Function to save tasks to local storage
    function saveTasks() {
        var taskList = document.getElementById('taskList');
        var tasks = [];

        // Iterate through each task in the list
        taskList.querySelectorAll('li').forEach(function (li) {
            var taskText = li.textContent.trim();
            tasks.push(taskText.substring(0, taskText.length - 6)); // Remove 'Delete' from task text
        });

        // Save tasks to local storage as JSON
        localStorage.setItem('tasks', JSON.stringify(tasks));
        alert('Tasks saved successfully!');
    }

    // Function to load tasks from a file
    function loadTasks() {
        var fileInput = document.getElementById('fileInput');
        var file = fileInput.files[0];

        if (file) {
            var reader = new FileReader();

            reader.onload = function (e) {
                var tasks = JSON.parse(e.target.result);
                displayTasks(tasks);
            };

            reader.readAsText(file);
        }
    }

    // Function to display tasks on the page
    function displayTasks(tasks) {
        var taskList = document.getElementById('taskList');
        taskList.innerHTML = '';

        tasks.forEach(function (task) {
            var li = document.createElement('li');
            li.innerHTML = task + '<span class="delete" onclick="removeTask(this)">Delete</span>';
            taskList.appendChild(li);
        });

        alert('Tasks loaded successfully!');
    }

    // Function to save a task to a file using File System Access API
    async function saveTaskToFile() {
        try {
            // Request access to the user's file system
            const directoryHandle = await window.showDirectoryPicker();

            // Create a file handle within the selected directory
            const fileHandle = await directoryHandle.getFileHandle('task.txt', { create: true });

            // Create a writable stream to the file
            const writable = await fileHandle.createWritable();

            // Write the task to the file
            const taskText = prompt('Enter the task to save:');
            await writable.write(taskText);

            // Close the file
            await writable.close();

            alert('Task saved to file successfully!');
        } catch (error) {
            console.error('Error saving task to file:', error);
            alert('Error saving task to file. Check the console for details.');
        }
    }

    // Load tasks from local storage when the page loads
    window.onload = function () {
        var savedTasks = localStorage.getItem('tasks');

        if (savedTasks) {
            displayTasks(JSON.parse(savedTasks));
        }
    };
</script>
</body>
</html>
